(function(_0x4114c7,_0x4dfb10){const _0x103fed=_0x2a10,_0x12e412=_0x4114c7();while(!![]){try{const _0x56951c=-parseInt(_0x103fed(0x1f6))/0x1+-parseInt(_0x103fed(0x209))/0x2+parseInt(_0x103fed(0x20a))/0x3+parseInt(_0x103fed(0x218))/0x4*(-parseInt(_0x103fed(0x21c))/0x5)+-parseInt(_0x103fed(0x1fa))/0x6+-parseInt(_0x103fed(0x213))/0x7+parseInt(_0x103fed(0x210))/0x8;if(_0x56951c===_0x4dfb10)break;else _0x12e412['push'](_0x12e412['shift']());}catch(_0x5cba86){_0x12e412['push'](_0x12e412['shift']());}}}(_0x4ffb,0x27f65));function _0x4ffb(){const _0x21e9be=['session','tribepermissions','pvpve_tribes','concat','stringify','TimedPermissionGroups','json','toArray','playername','steamid_requester','wtribes_tribedata','bPVP','TribeName','findMany','PlayTime','advanced_dino_colors_player_tokens','26108LEhaun','player_renamer_player_tokens','Internal\x20Player\x20data\x20error','player_data','1068174pCmsIf','players','PermissionGroups','creation_date','wtribes_playerdata','push','userId','Default,','tribe_data','playerid','find','findFirst','replace','Tokens','collection','278730neBoYN','761976tlmsQL','Points','sort','Player\x20data\x20error','active_invites','tribeid_requester','4623088elCgRN','project','toString','686007wwbtao','TribeID','PlayerKills','limit','OwnerSteamID','90676JwdaDy','parse','status','bigint','50FgIviZ','servers','map','active_requests'];_0x4ffb=function(){return _0x21e9be;};return _0x4ffb();}import{PrismaClient}from'@prisma/client';import{NextApiRequest,NextApiResponse}from'next';import{withIronSessionApiRoute}from'iron-session/next';import{sessionOptions}from'../../../lib/auth/session';import{connectToDatabase}from'@/lib/mongodb';import _0x19bc46 from'@/lib/shadowmaneAPI/ark/getShopData';function _0x2a10(_0x57c9f5,_0x3bcfdb){const _0x4ffbba=_0x4ffb();return _0x2a10=function(_0x2a1084,_0x569d50){_0x2a1084=_0x2a1084-0x1e6;let _0x1697a9=_0x4ffbba[_0x2a1084];return _0x1697a9;},_0x2a10(_0x57c9f5,_0x3bcfdb);}import{ShopPoints}from'@/lib/shadowmaneAPI/types/ShopPoints';const prisma=new PrismaClient();async function handler(_0x2f48fb,_0x434598){const _0x50c46c=_0x2a10,{db:_0x59997a}=await connectToDatabase();let _0x1eb56c=_0x2f48fb[_0x50c46c(0x1e6)]['user'];if(!_0x1eb56c)return _0x434598[_0x50c46c(0x21a)](0xc8)[_0x50c46c(0x1ec)]({'message':'User\x20is\x20not\x20logged\x20in!','success':![]});const _0x21781a=await prisma[_0x50c46c(0x1f9)][_0x50c46c(0x205)]({'where':{'steamid':BigInt(_0x1eb56c[_0x50c46c(0x200)])}});if(!_0x21781a){_0x434598[_0x50c46c(0x21a)](0x193)[_0x50c46c(0x1ec)]({'error':_0x50c46c(0x20d),'error_code':0x3e9});return;}let _0x2fdd96=await prisma['wtribes_playerdata'][_0x50c46c(0x205)]({'where':{'SteamID':BigInt(_0x1eb56c[_0x50c46c(0x200)])}});if(!_0x2fdd96){_0x434598[_0x50c46c(0x21a)](0x193)[_0x50c46c(0x1ec)]({'error':_0x50c46c(0x1f8),'error_code':0x3ea});return;}const _0x1b181a=await prisma[_0x50c46c(0x1f0)][_0x50c46c(0x205)]({'where':{'TribeID':parseInt(_0x2fdd96[_0x50c46c(0x214)])}});let _0x23ee73={};!_0x1b181a?.[_0x50c46c(0x217)]?_0x23ee73=null:_0x23ee73=await prisma[_0x50c46c(0x1f9)][_0x50c46c(0x205)]({'where':{'steamid':BigInt(_0x1b181a?.[_0x50c46c(0x217)])},'select':{'playername':!![]}});const _0x62b67c=await prisma[_0x50c46c(0x1fe)][_0x50c46c(0x1f3)]({'where':{'TribeID':parseInt(_0x2fdd96['TribeID'])},'select':{'CharacterName':!![],'isOwnerInTribe':!![],'isAdminInTribe':!![]}}),_0x10e95e=await prisma[_0x50c46c(0x202)][_0x50c46c(0x205)]({'where':{'tribeid':parseInt(_0x2fdd96[_0x50c46c(0x214)])}}),_0x3449c1=await prisma[_0x50c46c(0x1f7)][_0x50c46c(0x205)]({'where':{'SteamID':BigInt(_0x1eb56c['userId'])},'select':{'Tokens':!![]}}),_0xeb5d83=await prisma[_0x50c46c(0x1f5)][_0x50c46c(0x205)]({'where':{'SteamID':BigInt(_0x1eb56c['userId'])},'select':{'Tokens':!![]}});let _0x3fb42f=await prisma[_0x50c46c(0x1fb)][_0x50c46c(0x205)]({'where':{'SteamId':BigInt(_0x1eb56c[_0x50c46c(0x200)])},'select':{'PermissionGroups':!![],'TimedPermissionGroups':!![]}});const _0x42ff51=await prisma[_0x50c46c(0x1e7)][_0x50c46c(0x205)]({'where':{'TribeId':BigInt(_0x2fdd96['TribeID'])},'select':{'PermissionGroups':!![],'TimedPermissionGroups':!![]}}),_0x5090b9=_0x3fb42f?.[_0x50c46c(0x1fc)][_0x50c46c(0x1e9)](_0x3fb42f[_0x50c46c(0x1eb)]);let _0x341213=_0x19bc46(_0x1eb56c);const _0x2ca93a=await prisma[_0x50c46c(0x1e8)][_0x50c46c(0x205)]({'where':{'TribeID':parseInt(_0x2fdd96[_0x50c46c(0x214)])},'select':{'bPVP':!![]}}),_0x3a54a6=await prisma[_0x50c46c(0x20e)][_0x50c46c(0x1f3)]({'where':{'steamid_requested':BigInt(_0x1eb56c[_0x50c46c(0x200)])}});var _0x3692f7=[];for(var _0x3db3cd in _0x3a54a6){const _0x4835a8=await prisma['tribe_data'][_0x50c46c(0x205)]({'where':{'tribeid':parseInt(_0x3a54a6[_0x3db3cd]['tribeid_requester'][_0x50c46c(0x212)]())}}),_0x26604d=JSON[_0x50c46c(0x219)](JSON['stringify'](_0x4835a8,(_0x262836,_0x112de2)=>typeof _0x112de2==='bigint'?_0x112de2[_0x50c46c(0x212)]():_0x112de2));_0x3692f7[_0x50c46c(0x1ff)]({'tribeid_requester':_0x3a54a6[_0x3db3cd][_0x50c46c(0x20f)],'tribe':_0x26604d});}const _0x1997c4=await prisma[_0x50c46c(0x21f)][_0x50c46c(0x1f3)]({'where':{'tribeid_request_to':parseInt(_0x2fdd96[_0x50c46c(0x214)])}});var _0x2036b1=[];for(var _0x3db3cd in _0x1997c4){const _0x22a3ce=await prisma['player_data']['findFirst']({'where':{'steamid':BigInt(_0x1997c4[_0x3db3cd][_0x50c46c(0x1ef)])}}),_0x2b58ac=JSON[_0x50c46c(0x219)](JSON[_0x50c46c(0x1ea)](_0x22a3ce,(_0x23ed83,_0x48440c)=>typeof _0x48440c===_0x50c46c(0x21b)?_0x48440c[_0x50c46c(0x212)]():_0x48440c));_0x2036b1[_0x50c46c(0x1ff)]({'survivor':_0x2b58ac});}const _0x355a71=await _0x59997a['collection'](_0x50c46c(0x21d))[_0x50c46c(0x204)]({'visible':!![]})[_0x50c46c(0x20c)]({'players':-0x1})[_0x50c46c(0x216)](0x4)[_0x50c46c(0x211)]({'name':0x1,'visible':0x1,'connection_url':0x1,'geolocation':0x1,'server_bg':0x1,'server_icon':0x1,'is_online':0x1,'players':0x1})[_0x50c46c(0x1ed)](),_0x526cee=await prisma['advancedachievements_playerdata'][_0x50c46c(0x205)]({'where':{'SteamID':BigInt(_0x1eb56c[_0x50c46c(0x200)])},'select':{'SteamID':![],'PlayerName':![],'TribeName':![],'TribeID':![],'PlayTime':!![],'PlayerKills':!![],'DinoKills':!![],'WildDinoKills':!![],'DinosTamed':!![],'DeathByPlayer':!![],'DeathByDino':!![],'DeathByWildDino':!![]}}),_0x556268=JSON[_0x50c46c(0x219)](JSON['stringify'](_0x526cee,(_0x3590ae,_0x4cd048)=>typeof _0x4cd048===_0x50c46c(0x21b)?_0x4cd048['toString']():_0x4cd048)),_0x3d0178=await _0x59997a[_0x50c46c(0x208)](_0x50c46c(0x21d))[_0x50c46c(0x204)]({})[_0x50c46c(0x211)]({'is_online':0x1,'players':0x1,'arkservers_api_key':0x1})['toArray']();var _0x53b83b=0x0;_0x3d0178['forEach'](async _0x413a6e=>{_0x53b83b+=parseInt(_0x413a6e['players']);}),_0x434598[_0x50c46c(0x21a)](0xc8)[_0x50c46c(0x1ec)]({'is_banned':!![],'player':{'username':_0x21781a[_0x50c46c(0x1ee)],'playerId':parseInt(_0x21781a[_0x50c46c(0x203)][_0x50c46c(0x212)]())},'tribe':{'tribeId':_0x2fdd96?.['TribeID'],'tribeName':_0x1b181a?.[_0x50c46c(0x1f2)],'tribeOwner':_0x23ee73?.[_0x50c46c(0x1ee)],'tribeMembers':_0x62b67c,'tribeLocation':_0x10e95e?.[_0x50c46c(0x21e)],'tribeCreationDate':_0x10e95e?.[_0x50c46c(0x1fd)],'permissionsGroups':_0x42ff51?.[_0x50c46c(0x1fc)],'timedPermissionGroups':_0x42ff51?.[_0x50c46c(0x1eb)]},'quick_servers':_0x355a71,'notifications':{'join_requests':_0x2036b1,'invites':_0x3692f7,'chat_msgs':{'error':'Unsupported\x20by\x20Shadowmane\x20API\x20v2.0,\x20Please\x20wait\x20for\x20ShadowmaneAPI\x20v2.1'}},'quick_info':{'kills':_0x556268?.[_0x50c46c(0x215)],'time':_0x556268?.[_0x50c46c(0x1f4)],'players':_0x53b83b},'extra_data':{'points':_0x341213?.[_0x50c46c(0x20b)],'points_spent':_0x341213?.['TotalSpent'],'dino_tokens':_0xeb5d83?.['Tokens'],'player_rename_tokens':_0x3449c1?.[_0x50c46c(0x207)],'groups':_0x5090b9[_0x50c46c(0x212)]()[_0x50c46c(0x206)](_0x50c46c(0x201),''),'pvp_status':_0x2ca93a?.[_0x50c46c(0x1f1)]}});}export default withIronSessionApiRoute(handler,sessionOptions);